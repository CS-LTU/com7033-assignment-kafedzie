{% extends "base.html" %}

{% block title %}Patients List{% endblock %}

{% block content %}
<h2>Patient Records</h2>

<p>Total in database: {{ total_patients }}</p>
<p>Total shown on this page: {{ patients|length }}</p>

<h3>Filter Patients</h3>
<form method="get" action="{{ url_for('list_patients') }}" style="margin-bottom: 20px;">
    <label>Gender:</label>
    <select name="gender">
        <option value="">-- Any --</option>
        <option value="Male">Male</option>
        <option value="Female">Female</option>
    </select>

    <label>Stroke:</label>
    <select name="stroke">
        <option value="">-- Any --</option>
        <option value="0">No Stroke</option>
        <option value="1">Stroke</option>
    </select>

    <label>Smoking Status:</label>
    <select name="smoking_status">
        <option value="">-- Any --</option>
        <option value="never smoked">never smoked</option>
        <option value="formerly smoked">formerly smoked</option>
        <option value="smokes">smokes</option>
        <option value="Unknown">Unknown</option>
    </select>

    <button type="submit">Apply Filter</button>
</form>

<p><a href="{{ url_for('create_patient') }}">âž• Add New Patient</a></p>

<table>
    <thead>
        <tr>
            <th>ID</th>
            <th>Gender</th>
            <th>Age</th>
            <th>Hypertension</th>
            <th>Heart Disease</th>
            <th>Ever Married</th>
            <th>Work Type</th>
            <th>Residence</th>
            <th>Glucose</th>
            <th>BMI</th>
            <th>Smoking</th>
            <th>Stroke</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for p in patients %}
        <tr>
            <td>
                <a href="{{ url_for('patient_detail', patient_id=p['_id']) }}">
                    {{ p['_id'] }}
                </a>
            </td>
            <td>{{ p.get('gender') }}</td>
            <td>{{ p.get('age') }}</td>
            <td>{{ p.get('hypertension') }}</td>
            <td>{{ p.get('heart_disease') }}</td>
            <td>{{ p.get('ever_married') }}</td>
            <td>{{ p.get('work_type') }}</td>
            <td>{{ p.get('Residence_type') }}</td>
            <td>{{ p.get('avg_glucose_level') }}</td>
            <td>{{ p.get('bmi') }}</td>
            <td>{{ p.get('smoking_status') }}</td>
            <td>{{ p.get('stroke') }}</td>
            <td>
                <a href="{{ url_for('edit_patient', patient_id=p['_id']) }}">Edit</a>
                |
                <form method="POST"
                      action="{{ url_for('delete_patient', patient_id=p['_id']) }}"
                      style="display:inline;"
                      onsubmit="return confirm('Delete this patient?');">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <button type="submit" style="background:none;border:none;color:#c0392b;cursor:pointer;">
                        Delete
                    </button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}
