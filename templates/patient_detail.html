{% extends "base.html" %}

{% block title %}Patient Details - Healthcare Management System{% endblock %}

{% block content %}
<div class="container">
    <!-- Breadcrumb -->
    <div style="margin-bottom: 1.5rem; color: #64748b; font-size: 0.9rem;">
        <a href="{{ url_for('list_patients') }}" style="color: #2563eb;">← Back to Patients</a>
    </div>

    <!-- Page Header -->
    <div class="flex-between mb-3">
        <div class="page-header">
            <h1 class="page-title">Patient Record</h1>
            <p class="page-subtitle">ID: {{ patient._id }}</p>
        </div>
        <div class="btn-group">
            <a href="{{ url_for('edit_patient', patient_id=patient._id) }}" class="btn btn-primary">Edit Record</a>
            {% if current_user.is_admin() %}
            <form method="POST" action="{{ url_for('delete_patient', patient_id=patient._id) }}" 
                onsubmit="return confirm('Are you sure you want to delete this patient record? This action cannot be undone.');" 
                  style="display: inline;">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <button type="submit" class="btn btn-danger">Delete</button>
            </form>
            {% endif %}
        </div>
    </div>

    <!-- Risk Assessment Card -->
    <div class="card mb-3" style="border-left: 4px solid {% if patient.stroke == 1 %}#ef4444{% else %}#10b981{% endif %};">
        <div class="card-body">
            <div style="display: flex; align-items: center; gap: 1rem;">
                <div style="font-size: 3rem;">
                    {% if patient.stroke == 1 %}⚠️{% else %}✓{% endif %}
                </div>
                <div style="flex: 1;">
                    <h3 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 0.5rem;">
                        Stroke Status: 
                        <span style="color: {% if patient.stroke == 1 %}#ef4444{% else %}#10b981{% endif %};">
                            {% if patient.stroke == 1 %}Positive{% else %}Negative{% endif %}
                        </span>
                    </h3>
                    <p style="color: #64748b; margin: 0;">
                        {% if patient.stroke == 1 %}
                            This patient has a history of stroke. Requires regular monitoring and follow-up care.
                        {% else %}
                            No stroke history recorded for this patient.
                        {% endif %}
                    </p>
                </div>
            </div>
        </div>
    </div>

    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 1.5rem;">
        <!-- Demographics -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Demographics</h3>
            </div>
            <div class="card-body">
                <div class="detail-grid" style="grid-template-columns: 1fr;">
                    <div class="detail-item">
                        <div class="detail-label">Gender</div>
                        <div class="detail-value">{{ patient.gender }}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Age</div>
                        <div class="detail-value">{{ patient.age }} years</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Marital Status</div>
                        <div class="detail-value">{{ patient.ever_married }}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Residence Type</div>
                        <div class="detail-value">{{ patient.Residence_type }}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Work Type</div>
                        <div class="detail-value">{{ patient.work_type }}</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Medical History -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Medical History</h3>
            </div>
            <div class="card-body">
                <div class="detail-grid" style="grid-template-columns: 1fr;">
                    <div class="detail-item" style="background: {% if patient.hypertension == 1 %}#fee2e2{% else %}#d1fae5{% endif %};">
                        <div class="detail-label">Hypertension</div>
                        <div class="detail-value" style="color: {% if patient.hypertension == 1 %}#991b1b{% else %}#065f46{% endif %};">
                            {% if patient.hypertension == 1 %}Yes{% else %}No{% endif %}
                        </div>
                    </div>
                    <div class="detail-item" style="background: {% if patient.heart_disease == 1 %}#fee2e2{% else %}#d1fae5{% endif %};">
                        <div class="detail-label">Heart Disease</div>
                        <div class="detail-value" style="color: {% if patient.heart_disease == 1 %}#991b1b{% else %}#065f46{% endif %};">
                            {% if patient.heart_disease == 1 %}Yes{% else %}No{% endif %}
                        </div>
                    </div>
                    <div class="detail-item" style="background: 
                        {% if patient.smoking_status == 'smokes' %}#fee2e2
                        {% elif patient.smoking_status == 'formerly smoked' %}#fef3c7
                        {% else %}#d1fae5{% endif %};">
                        <div class="detail-label">Smoking Status</div>
                        <div class="detail-value" style="color: 
                            {% if patient.smoking_status == 'smokes' %}#991b1b
                            {% elif patient.smoking_status == 'formerly smoked' %}#92400e
                            {% else %}#065f46{% endif %};">
                            {{ patient.smoking_status|title }}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Health Metrics -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Health Metrics</h3>
            </div>
            <div class="card-body">
                <div class="detail-grid" style="grid-template-columns: 1fr;">
                    <div class="detail-item">
                        <div class="detail-label">Body Mass Index (BMI)</div>
                        <div class="detail-value">
                            {{ "%.1f"|format(patient.bmi) }}
                            <span style="font-size: 0.875rem; color: #64748b; font-weight: 400;">
                                {% if patient.bmi < 18.5 %}(Underweight)
                                {% elif patient.bmi < 25 %}(Normal)
                                {% elif patient.bmi < 30 %}(Overweight)
                                {% else %}(Obese){% endif %}
                            </span>
                        </div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Average Glucose Level</div>
                        <div class="detail-value">
                            {{ "%.1f"|format(patient.avg_glucose_level) }} mg/dL
                            <span style="font-size: 0.875rem; color: #64748b; font-weight: 400;">
                                {% if patient.avg_glucose_level < 100 %}(Normal)
                                {% elif patient.avg_glucose_level < 126 %}(Prediabetes)
                                {% else %}(Diabetes){% endif %}
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Risk Factors Summary -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Risk Factors Summary</h3>
            </div>
            <div class="card-body">
                <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                    {% set risk_count = 0 %}
                    {% if patient.hypertension == 1 %}
                        {% set risk_count = risk_count + 1 %}
                        <div style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem; background: #fee2e2; border-radius: 0.5rem;">
                            <span style="color: #ef4444;">⚠️</span>
                            <span style="font-weight: 500; color: #991b1b;">Hypertension Present</span>
                        </div>
                    {% endif %}
                    {% if patient.heart_disease == 1 %}
                        {% set risk_count = risk_count + 1 %}
                        <div style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem; background: #fee2e2; border-radius: 0.5rem;">
                            <span style="color: #ef4444;">⚠️</span>
                            <span style="font-weight: 500; color: #991b1b;">Heart Disease Present</span>
                        </div>
                    {% endif %}
                    {% if patient.smoking_status == 'smokes' %}
                        {% set risk_count = risk_count + 1 %}
                        <div style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem; background: #fee2e2; border-radius: 0.5rem;">
                            <span style="color: #ef4444;">⚠️</span>
                            <span style="font-weight: 500; color: #991b1b;">Active Smoker</span>
                        </div>
                    {% endif %}
                    {% if patient.bmi >= 30 %}
                        {% set risk_count = risk_count + 1 %}
                        <div style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem; background: #fef3c7; border-radius: 0.5rem;">
                            <span style="color: #f59e0b;">⚠️</span>
                            <span style="font-weight: 500; color: #92400e;">Obesity (BMI ≥ 30)</span>
                        </div>
                    {% endif %}
                    {% if patient.avg_glucose_level >= 126 %}
                        {% set risk_count = risk_count + 1 %}
                        <div style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem; background: #fef3c7; border-radius: 0.5rem;">
                            <span style="color: #f59e0b;">⚠️</span>
                            <span style="font-weight: 500; color: #92400e;">Diabetic Range Glucose</span>
                        </div>
                    {% endif %}
                    
                    {% if risk_count == 0 %}
                        <div style="text-align: center; padding: 2rem; color: #10b981;">
                            <div style="font-size: 3rem; margin-bottom: 0.5rem;">✓</div>
                            <div style="font-weight: 600;">No Major Risk Factors</div>
                        </div>
                    {% else %}
                        <div style="margin-top: 0.5rem; padding: 0.75rem; background: var(--very-light-blue); border-radius: 0.5rem; text-align: center;">
                            <span style="font-weight: 600; color: var(--primary-blue);">
                                {{ risk_count }} Risk Factor{% if risk_count > 1 %}s{% endif %} Identified
                            </span>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
