{% extends "base.html" %}

{% block title %}Edit Patient - Healthcare Management System{% endblock %}

{% block content %}
<div class="container">
    <!-- Breadcrumb -->
    <div style="margin-bottom: 1.5rem; color: #64748b; font-size: 0.9rem;">
        <a href="{{ url_for('list_patients') }}" style="color: #2563eb;">‚Üê Back to Patients</a>
        <span style="margin: 0 0.5rem;">/</span>
        <a href="{{ url_for('patient_detail', patient_id=patient._id) }}" style="color: #2563eb;">Patient Details</a>
    </div>

    <!-- Page Header -->
    <div class="page-header mb-3">
        <h1 class="page-title">Edit Patient Record</h1>
        <p class="page-subtitle">Update patient information</p>
    </div>

    <!-- Form -->
    <div class="card" style="max-width: 800px;">
        <form method="POST" action="{{ url_for('edit_patient', patient_id=patient._id) }}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <div class="card-body">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                    
                    <!-- Demographics Section -->
                    <div style="grid-column: 1 / -1;">
                        <h3 style="font-size: 1.125rem; font-weight: 600; color: var(--text-dark); margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 2px solid var(--primary-blue);">
                            Demographics
                        </h3>
                    </div>

                    <div class="form-group">
                        <label for="gender">Gender *</label>
                        <select name="gender" id="gender" required>
                            <option value="Male" {% if patient.gender == 'Male' %}selected{% endif %}>Male</option>
                            <option value="Female" {% if patient.gender == 'Female' %}selected{% endif %}>Female</option>
                            <option value="Other" {% if patient.gender == 'Other' %}selected{% endif %}>Other</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="age">Age *</label>
                        <input type="number" name="age" id="age" value="{{ patient.age }}" required min="0" max="150">
                    </div>

                    <div class="form-group">
                        <label for="ever_married">Marital Status *</label>
                        <select name="ever_married" id="ever_married" required>
                            <option value="Yes" {% if patient.ever_married == 'Yes' %}selected{% endif %}>Married</option>
                            <option value="No" {% if patient.ever_married == 'No' %}selected{% endif %}>Single</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="work_type">Work Type *</label>
                        <select name="work_type" id="work_type" required>
                            <option value="Private" {% if patient.work_type == 'Private' %}selected{% endif %}>Private</option>
                            <option value="Self-employed" {% if patient.work_type == 'Self-employed' %}selected{% endif %}>Self-employed</option>
                            <option value="Govt_job" {% if patient.work_type == 'Govt_job' %}selected{% endif %}>Government Job</option>
                            <option value="children" {% if patient.work_type == 'children' %}selected{% endif %}>Children</option>
                            <option value="Never_worked" {% if patient.work_type == 'Never_worked' %}selected{% endif %}>Never Worked</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="Residence_type">Residence Type *</label>
                        <select name="Residence_type" id="Residence_type" required>
                            <option value="Urban" {% if patient.Residence_type == 'Urban' %}selected{% endif %}>Urban</option>
                            <option value="Rural" {% if patient.Residence_type == 'Rural' %}selected{% endif %}>Rural</option>
                        </select>
                    </div>

                    <!-- Medical History Section -->
                    <div style="grid-column: 1 / -1; margin-top: 1rem;">
                        <h3 style="font-size: 1.125rem; font-weight: 600; color: var(--text-dark); margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 2px solid var(--primary-blue);">
                            Medical History
                        </h3>
                    </div>

                    <div class="form-group">
                        <label for="hypertension">Hypertension *</label>
                        <select name="hypertension" id="hypertension" required>
                            <option value="0" {% if patient.hypertension == 0 %}selected{% endif %}>No</option>
                            <option value="1" {% if patient.hypertension == 1 %}selected{% endif %}>Yes</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="heart_disease">Heart Disease *</label>
                        <select name="heart_disease" id="heart_disease" required>
                            <option value="0" {% if patient.heart_disease == 0 %}selected{% endif %}>No</option>
                            <option value="1" {% if patient.heart_disease == 1 %}selected{% endif %}>Yes</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="smoking_status">Smoking Status *</label>
                        <select name="smoking_status" id="smoking_status" required>
                            <option value="never smoked" {% if patient.smoking_status == 'never smoked' %}selected{% endif %}>Never Smoked</option>
                            <option value="formerly smoked" {% if patient.smoking_status == 'formerly smoked' %}selected{% endif %}>Formerly Smoked</option>
                            <option value="smokes" {% if patient.smoking_status == 'smokes' %}selected{% endif %}>Smokes</option>
                            <option value="Unknown" {% if patient.smoking_status == 'Unknown' %}selected{% endif %}>Unknown</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="stroke">Stroke History *</label>
                        <select name="stroke" id="stroke" required>
                            <option value="0" {% if patient.stroke == 0 %}selected{% endif %}>No</option>
                            <option value="1" {% if patient.stroke == 1 %}selected{% endif %}>Yes</option>
                        </select>
                    </div>

                    <!-- Health Metrics Section -->
                    <div style="grid-column: 1 / -1; margin-top: 1rem;">
                        <h3 style="font-size: 1.125rem; font-weight: 600; color: var(--text-dark); margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 2px solid var(--primary-blue);">
                            Health Metrics
                        </h3>
                    </div>

                    <div class="form-group">
                        <label for="bmi">Body Mass Index (BMI) *</label>
                        <input type="number" name="bmi" id="bmi" value="{{ patient.bmi }}" required step="0.1" min="10" max="100">
                        <div style="font-size: 0.875rem; color: var(--text-medium); margin-top: 0.25rem;">
                            Normal range: 18.5 - 24.9
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="avg_glucose_level">Average Glucose Level (mg/dL) *</label>
                        <input type="number" name="avg_glucose_level" id="avg_glucose_level" value="{{ patient.avg_glucose_level }}" required step="0.1" min="0" max="500">
                        <div style="font-size: 0.875rem; color: var(--text-medium); margin-top: 0.25rem;">
                            Normal range: 70 - 100 mg/dL
                        </div>
                    </div>
                </div>
            </div>

            <div class="card-header" style="background: var(--background-alt); border-top: 1px solid var(--border); border-bottom: none;">
                <div class="btn-group" style="justify-content: flex-end; width: 100%;">
                    <a href="{{ url_for('patient_detail', patient_id=patient._id) }}" class="btn btn-secondary">Cancel</a>
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </div>
            </div>
        </form>
    </div>
</div>
{% endblock %}
